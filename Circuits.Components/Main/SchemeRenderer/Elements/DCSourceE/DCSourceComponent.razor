@using Circuits.ViewModels.Entities.Elements
<div @key="@DCSource"
     draggable="true"
     @ondragenter="() => { }"
     @ondragenter:preventDefault
     @onextdragstart="OnDragStart"
     @onextdragstart:preventDefault="@_dragAllowed"
     @onextdragend="OnDragEnd"
     class="@($"dc-source element {(_horizontal ? "horizontal" : "vertical")} {(_selectedElement == DCSource ? "selected" : "")} {(_draggingElement == DCSource && _firstDragOver ? "dragging" : "")} {(_eventsDisabled ? "disabled" : "")}")"
     style="@($"left: {DCSource.P1.X * CellSize}px; top: {DCSource.P1.Y * CellSize}px; width: {Math.Abs(DCSource.P2.X * CellSize - DCSource.P1.X * CellSize)}px; height: {Math.Abs(DCSource.P2.Y * CellSize - DCSource.P1.Y * CellSize)}px;")">

    <div @onclick="OnElementClicked"
         @onclick:stopPropagation
         onmousedown="event.stopPropagation()"
         onmousemove="event.preventDefault()"
         class="dc-source-content">

        <div class="circle"></div>
        <div class="circle"></div>

        <div class="block">
            <div class="delimiter @(DCSource.Reverse ? "" : "short")"></div>
            <div class="delimiter @(DCSource.Reverse ? "short" : "")"></div>
        </div>
    </div>

</div>

@if (_draggingElement == DCSource && _firstDragOver)
{
    var draggingElement = (DCSource)_draggingElement;

    <div class="@($"dc-source dragged {(_horizontal ? "horizontal" : "vertical")} {(_selectedElement == draggingElement ? "selected" : "")}")"
         style="@($"left: {_draggingPos.X.ToString(_nF)}px; top: {_draggingPos.Y.ToString(_nF)}px; width: {Math.Abs(draggingElement.P2.X * CellSize - draggingElement.P1.X * CellSize)}px; height: {Math.Abs(draggingElement.P2.Y * CellSize - draggingElement.P1.Y * CellSize)}px;")">

        <div class="dc-source-content">
            <div class="circle"></div>
            <div class="circle"></div>

            <div class="block">
                <div class="delimiter @(DCSource.Reverse ? "" : "short")"></div>
                <div class="delimiter @(DCSource.Reverse ? "short" : "")"></div>
            </div>
        </div>

    </div>
}